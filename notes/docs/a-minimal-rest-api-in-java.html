<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="canonical" href="https://notes.eatonphil.com/a-minimal-rest-api-in-java.html">
    <title>A minimal REST API in Java | notes.eatonphil.com</title>
    <meta name="description" content="A minimal REST API in Java" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="alternate" type="application/rss+xml" href="/rss.xml" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Mono">
  </head>
  <body>
    <header>
      <div class="lfw">
	<div class="container">
	  <div class="row">
	    <a href="https://eatonphil.com/30.html">Turning 30, a little fundraiser ðŸŽ‰</a>
	  </div>
	</div>
      </div>
      <div class="container">
        <div>
          <div class="row">
	    <div>
	      <a href="https://eatonphil.com" class="sm-link">
		Home
              </a>
	      <a href="/" class="sm-link">
		Blog
              </a>
	      <a href="/rss.xml" class="sm-link">
		RSS
              </a>
	    </div>

	    <div class="subscribe">
	      <!-- <a href="https://eatonphil.com/hire-me.html">Hire me</a> -->
	      <!--
		  Hardcode link to home page because some pages don't
		  have a subscribe box. Some pages hide the subscribe.
		-->
	      <a href="https://eatonphil.com/subscribe.html">
		Subscribe
	      </a>
            </div>
	  </div>
	  <hr />
	  <div class="">
            <h2>February 1, 2020</h2>
            <h1>A minimal REST API in Java</h1>
	    
            <div class="row" style="padding-bottom: 5px">
              <div class="tags"><a href="/tags/java.html" class="tag">java</a><a href="/tags/rest.html" class="tag">rest</a><a href="/tags/api.html" class="tag">api</a><a href="/tags/jersey.html" class="tag">jersey</a><a href="/tags/jooq.html" class="tag">jooq</a><a href="/tags/postgres.html" class="tag">postgres</a></div>
            </div>
	  </div>
	</div>
      </div>
    </header>
    <div class="container">
      <div class="col-6">
	<div class="post">
          <p>There's a style of Java that is a joy to write. This post will cover
how to set up a basic PostgreSQL-integrated REST API using
<a href="https://eclipse-ee4j.github.io/jersey/">Jersey</a> and
<a href="https://www.jooq.org/">JOOQ</a> in a style not dissimilar to Flask and
SQLAlchemy in Python.</p>
<p>In particular, we'll try to avoid as much runtime
reflection/class-loading as possible. This will make the application
less flexible but easier to debug and understand.</p>
<p>I'd appreciate pointers in email if you see anything weird or can fix
any of my bugs.</p>
<h3 id="dependencies">Dependencies</h3><p>Install <a href="https://maven.apache.org/">Maven</a>, a recent
<a href="https://openjdk.java.net/">JDK</a>, and PostgreSQL.</p>
<p>Copy the following into <code>pom.xml</code> to tell Maven about Java
dependencies:</p>
<div class="highlight"><pre><span></span><span class="nt">&lt;project</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span><span class="w"> </span><span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<span class="w">         </span><span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>

<span class="w">  </span><span class="nt">&lt;groupId&gt;</span>api<span class="nt">&lt;/groupId&gt;</span>
<span class="w">  </span><span class="nt">&lt;artifactId&gt;</span>api<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">  </span><span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>

<span class="w">  </span><span class="nt">&lt;properties&gt;</span>
<span class="w">    </span><span class="nt">&lt;maven.compiler.source&gt;</span>13<span class="nt">&lt;/maven.compiler.source&gt;</span>
<span class="w">    </span><span class="nt">&lt;maven.compiler.target&gt;</span>13<span class="nt">&lt;/maven.compiler.target&gt;</span>
<span class="w">  </span><span class="nt">&lt;/properties&gt;</span>

<span class="w">  </span><span class="nt">&lt;build&gt;</span>
<span class="w">    </span><span class="nt">&lt;plugins&gt;</span>
<span class="w">      </span><span class="nt">&lt;plugin&gt;</span>
<span class="w">        </span><span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
<span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">        </span><span class="nt">&lt;version&gt;</span>3.8.1<span class="nt">&lt;/version&gt;</span>
<span class="w">        </span><span class="nt">&lt;configuration&gt;</span>
<span class="w">          </span><span class="nt">&lt;compilerArgs&gt;</span>
<span class="w">            </span><span class="nt">&lt;arg&gt;</span>-Xlint:all,-options,-path<span class="nt">&lt;/arg&gt;</span>
<span class="w">          </span><span class="nt">&lt;/compilerArgs&gt;</span>
<span class="w">        </span><span class="nt">&lt;/configuration&gt;</span>
<span class="w">      </span><span class="nt">&lt;/plugin&gt;</span>

<span class="w">      </span><span class="nt">&lt;plugin&gt;</span>
<span class="w">        </span><span class="nt">&lt;groupId&gt;</span>org.codehaus.mojo<span class="nt">&lt;/groupId&gt;</span>
<span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>exec-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">        </span><span class="nt">&lt;version&gt;</span>1.6.0<span class="nt">&lt;/version&gt;</span>
<span class="w">        </span><span class="nt">&lt;configuration&gt;</span>
<span class="w">          </span><span class="nt">&lt;mainClass&gt;</span>api.Main<span class="nt">&lt;/mainClass&gt;</span>
<span class="w">        </span><span class="nt">&lt;/configuration&gt;</span>
<span class="w">      </span><span class="nt">&lt;/plugin&gt;</span>
<span class="w">    </span><span class="nt">&lt;/plugins&gt;</span>
<span class="w">  </span><span class="nt">&lt;/build&gt;</span>

<span class="w">  </span><span class="nt">&lt;dependencies&gt;</span>
<span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
<span class="w">      </span><span class="nt">&lt;groupId&gt;</span>org.glassfish.jersey.containers<span class="nt">&lt;/groupId&gt;</span>
<span class="w">      </span><span class="nt">&lt;artifactId&gt;</span>jersey-container-jetty-http<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">      </span><span class="nt">&lt;version&gt;</span>2.30<span class="nt">&lt;/version&gt;</span>
<span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>

<span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
<span class="w">      </span><span class="nt">&lt;groupId&gt;</span>org.jooq<span class="nt">&lt;/groupId&gt;</span>
<span class="w">      </span><span class="nt">&lt;artifactId&gt;</span>jooq<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">      </span><span class="nt">&lt;version&gt;</span>3.12.3<span class="nt">&lt;/version&gt;</span>
<span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>

<span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
<span class="w">      </span><span class="nt">&lt;groupId&gt;</span>org.jooq<span class="nt">&lt;/groupId&gt;</span>
<span class="w">      </span><span class="nt">&lt;artifactId&gt;</span>jooq-meta<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">      </span><span class="nt">&lt;version&gt;</span>3.12.3<span class="nt">&lt;/version&gt;</span>
<span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>

<span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
<span class="w">      </span><span class="nt">&lt;groupId&gt;</span>org.postgresql<span class="nt">&lt;/groupId&gt;</span>
<span class="w">      </span><span class="nt">&lt;artifactId&gt;</span>postgresql<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">      </span><span class="nt">&lt;version&gt;</span>42.2.9<span class="nt">&lt;/version&gt;</span>
<span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>

<span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
<span class="w">      </span><span class="nt">&lt;groupId&gt;</span>org.glassfish.jersey.inject<span class="nt">&lt;/groupId&gt;</span>
<span class="w">      </span><span class="nt">&lt;artifactId&gt;</span>jersey-hk2<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">      </span><span class="nt">&lt;version&gt;</span>2.30<span class="nt">&lt;/version&gt;</span>
<span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>

<span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
<span class="w">      </span><span class="nt">&lt;groupId&gt;</span>ch.qos.logback<span class="nt">&lt;/groupId&gt;</span>
<span class="w">      </span><span class="nt">&lt;artifactId&gt;</span>logback-core<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">      </span><span class="nt">&lt;version&gt;</span>1.2.3<span class="nt">&lt;/version&gt;</span>
<span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>

<span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
<span class="w">      </span><span class="nt">&lt;groupId&gt;</span>org.slf4j<span class="nt">&lt;/groupId&gt;</span>
<span class="w">      </span><span class="nt">&lt;artifactId&gt;</span>slf4j-api<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">      </span><span class="nt">&lt;version&gt;</span>1.7.30<span class="nt">&lt;/version&gt;</span>
<span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>

<span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
<span class="w">      </span><span class="nt">&lt;groupId&gt;</span>ch.qos.logback<span class="nt">&lt;/groupId&gt;</span>
<span class="w">      </span><span class="nt">&lt;artifactId&gt;</span>logback-classic<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">      </span><span class="nt">&lt;version&gt;</span>1.2.3<span class="nt">&lt;/version&gt;</span>
<span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>

<span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
<span class="w">      </span><span class="nt">&lt;groupId&gt;</span>org.glassfish.jersey.media<span class="nt">&lt;/groupId&gt;</span>
<span class="w">      </span><span class="nt">&lt;artifactId&gt;</span>jersey-media-json-jackson<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">      </span><span class="nt">&lt;version&gt;</span>2.30<span class="nt">&lt;/version&gt;</span>
<span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>

<span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
<span class="w">      </span><span class="nt">&lt;groupId&gt;</span>javax.persistence<span class="nt">&lt;/groupId&gt;</span>
<span class="w">      </span><span class="nt">&lt;artifactId&gt;</span>javax.persistence-api<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">      </span><span class="nt">&lt;version&gt;</span>2.2<span class="nt">&lt;/version&gt;</span>
<span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>

<span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
<span class="w">      </span><span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
<span class="w">      </span><span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">      </span><span class="nt">&lt;version&gt;</span>1.18.10<span class="nt">&lt;/version&gt;</span>
<span class="w">      </span><span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
<span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>

<span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
<span class="w">      </span><span class="nt">&lt;groupId&gt;</span>com.fasterxml.jackson<span class="nt">&lt;/groupId&gt;</span>
<span class="w">      </span><span class="nt">&lt;artifactId&gt;</span>jackson-bom<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">      </span><span class="nt">&lt;version&gt;</span>2.10.2<span class="nt">&lt;/version&gt;</span>
<span class="w">      </span><span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
<span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>
<span class="w">  </span><span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</pre></div>
<p>Now run <code>mvn install</code> to download and configure all dependencies.</p>
<h3 id="project-setup">Project setup</h3><p>The <code>Main</code> class will be our entrypoint
within <code>src/main/java/api/Main.java</code>.</p>
<p>It will handle loading configuration, setting up the application
server, and starting it.</p>
<div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">api</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.InputStream</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">api.app.Application</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">api.app.Config</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Main</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">var</span><span class="w"> </span><span class="n">cfg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Config</span><span class="p">();</span>
<span class="w">      </span><span class="kd">var</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Application</span><span class="p">(</span><span class="n">cfg</span><span class="p">);</span>
<span class="w">      </span><span class="n">server</span><span class="p">.</span><span class="na">start</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>The <code>Config</code> class in
<code>src/main/java/api/app/Config.java</code> will contain a few
hard-coded settings for now. In the future it could be read from a
file.</p>
<div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">api.app</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.InputStream</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.Duration</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Properties</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Config</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">server_address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;http://localhost&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">server_port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7780</span><span class="p">;</span>

<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">db_connection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;jdbc:postgresql://localhost/todo&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">db_username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;todo&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">db_password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;todo&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>And finally the <code>Application</code> class
in <code>src/main/java/api/app/Application.java</code> will handle
loading a PostgreSQL connection, registering the class path to look
for Jersey routes/controllers, registering the PostgreSQL connection
in the dependency injection controller and starting the Jersey
controller.</p>
<div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">api.app</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">javax.ws.rs.core.UriBuilder</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.glassfish.jersey.internal.inject.AbstractBinder</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.glassfish.jersey.jetty.JettyHttpContainerFactory</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.glassfish.jersey.server.ResourceConfig</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.slf4j.LoggerFactory</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">api.dao.Dao</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">ch.qos.logback.classic.Level</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">ch.qos.logback.classic.Logger</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Application</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Logger</span><span class="w"> </span><span class="n">logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Logger</span><span class="p">)</span><span class="w"> </span><span class="n">LoggerFactory</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="n">Application</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Logger</span><span class="w"> </span><span class="n">rootLogger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Logger</span><span class="p">)</span><span class="w"> </span><span class="n">LoggerFactory</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="n">Logger</span><span class="p">.</span><span class="na">ROOT_LOGGER_NAME</span><span class="p">);</span>
<span class="w">  </span><span class="kd">static</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">rootLogger</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="n">Config</span><span class="w"> </span><span class="n">cfg</span><span class="p">;</span>

<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="nf">Application</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">Config</span><span class="w"> </span><span class="n">_cfg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">cfg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_cfg</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addShutdownHook</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">Runnable</span><span class="w"> </span><span class="n">hook</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Runtime</span><span class="p">.</span><span class="na">getRuntime</span><span class="p">().</span><span class="na">addShutdownHook</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(</span><span class="n">hook</span><span class="p">));</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">start</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">dao</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Dao</span><span class="p">(</span><span class="n">cfg</span><span class="p">.</span><span class="na">db_connection</span><span class="p">,</span><span class="w"> </span><span class="n">cfg</span><span class="p">.</span><span class="na">db_username</span><span class="p">,</span><span class="w"> </span><span class="n">cfg</span><span class="p">.</span><span class="na">db_password</span><span class="p">);</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">dao</span><span class="p">.</span><span class="na">initialize</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">      </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">addShutdownHook</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">dao</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">java</span><span class="p">.</span><span class="na">sql</span><span class="p">.</span><span class="na">SQLException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">resourceConfig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResourceConfig</span><span class="p">();</span>
<span class="w">    </span><span class="n">resourceConfig</span><span class="p">.</span><span class="na">packages</span><span class="p">(</span><span class="s">&quot;api.controller&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">resourceConfig</span><span class="p">.</span><span class="na">register</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">AbstractBinder</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nd">@Override</span>
<span class="w">      </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">configure</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">bind</span><span class="p">(</span><span class="n">dao</span><span class="p">).</span><span class="na">to</span><span class="p">(</span><span class="n">Dao</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">baseUri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UriBuilder</span><span class="p">.</span><span class="na">fromUri</span><span class="p">(</span><span class="n">cfg</span><span class="p">.</span><span class="na">server_address</span><span class="p">).</span><span class="na">port</span><span class="p">(</span><span class="n">cfg</span><span class="p">.</span><span class="na">server_port</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JettyHttpContainerFactory</span><span class="p">.</span><span class="na">createServer</span><span class="p">(</span><span class="n">baseUri</span><span class="p">,</span><span class="w"> </span><span class="n">resourceConfig</span><span class="p">);</span>
<span class="w">    </span><span class="n">logger</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;Started listening on {}:{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">cfg</span><span class="p">.</span><span class="na">server_address</span><span class="p">,</span><span class="w"> </span><span class="n">cfg</span><span class="p">.</span><span class="na">server_port</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p class="note">
  I couldn't figure out a reasonable way to avoid the class path
  registration for routes.
  <br />
  <br />
  It's also important to note that the <code>AbstractBinder</code>
  appears to search the class path implicitly for any available
  dependency injection controller. I'd rather we had specified it
  explicitly but I'm not sure how. It will succeed because we
  installed
  <a href="https://javaee.github.io/hk2/">HK2</a> as a dependency
  (see <code>pom.xml</code>).
</p><p>With the <code>Application</code> code finished, we'll need to build
out the referenced <code>Dao</code> and controller classes.</p>
<h3 id="dao">Dao</h3><p>The <code>Dao</code> class in
<code>src/main/java/api/dao/Dao.java</code> will enclose the
connection to PostgreSQL via JOOQ.</p>
<div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">api.dao</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.sql.Connection</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.sql.DriverManager</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.sql.SQLException</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.jooq.DSLContext</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.jooq.SQLDialect</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.jooq.impl.DSL</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Dao</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">Connection</span><span class="w"> </span><span class="n">conn</span><span class="p">;</span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">url</span><span class="p">;</span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">username</span><span class="p">;</span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">password</span><span class="p">;</span>

<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="nf">Dao</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">_url</span><span class="p">,</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">_username</span><span class="p">,</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">_password</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_url</span><span class="p">;</span>
<span class="w">    </span><span class="n">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_username</span><span class="p">;</span>
<span class="w">    </span><span class="n">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_password</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">initialize</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">SQLException</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">conn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DriverManager</span><span class="p">.</span><span class="na">getConnection</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="n">password</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">close</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">SQLException</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">conn</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">DSLContext</span><span class="w"> </span><span class="nf">getDSLContext</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">DSL</span><span class="p">.</span><span class="na">using</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span><span class="w"> </span><span class="n">SQLDialect</span><span class="p">.</span><span class="na">POSTGRES</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>And this will be enough to use in our controller. But let's take a
moment to talk about the data model.</p>
<h3 id="data">Data</h3><p>This API will return results from a TODO list. The database should
store each TODO item and a timestamp of completion, if completed.</p>
<p>We'll start by creating a database and user for the application:</p>
<div class="highlight"><pre><span></span>$<span class="w"> </span>sudo<span class="w"> </span>su<span class="w"> </span>postgres
postgres<span class="w"> </span>$<span class="w"> </span>psql
<span class="nv">postgres</span><span class="o">=</span><span class="c1"># CREATE DATABASE todo;</span>
<span class="nv">postgres</span><span class="o">=</span><span class="c1"># CREATE USER todo WITH PASSWORD &#39;todo&#39;;</span>
<span class="nv">postgres</span><span class="o">=</span><span class="c1"># GRANT ALL ON DATABASE todo TO todo;</span>
</pre></div>
<p>Then we'll write an initial migration:</p>
<div class="highlight"><pre><span></span><span class="err">$</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="n">migrations</span><span class="o">/</span><span class="mi">1</span><span class="n">_init</span><span class="p">.</span><span class="k">sql</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">todo_item</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="n">BIGSERIAL</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">  </span><span class="n">item</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">  </span><span class="n">created_at</span><span class="w"> </span><span class="n">TIMESTAMPTZ</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">(),</span>
<span class="w">  </span><span class="n">completed_at</span><span class="w"> </span><span class="n">TIMESTAMPTZ</span>
<span class="p">);</span>
</pre></div>
<p>And a helper script for running migrations:</p>
<div class="highlight"><pre><span></span>$<span class="w"> </span>cat<span class="w"> </span>scripts/migrate.sh
<span class="c1">#!/usr/bin/env bash</span>

<span class="nb">set</span><span class="w"> </span>-e

<span class="nb">export</span><span class="w"> </span><span class="nv">PGPASSWORD</span><span class="o">=</span>todo

<span class="k">for</span><span class="w"> </span>file<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">$(</span>ls<span class="w"> </span>migrations<span class="k">)</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Running migration: </span><span class="nv">$file</span><span class="s2">&quot;</span>
<span class="w">    </span>psql<span class="w"> </span>-U<span class="w"> </span>todo<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;migrations/</span><span class="nv">$file</span><span class="s2">&quot;</span>
<span class="k">done</span>
</pre></div>
<p>Run it:</p>
<div class="highlight"><pre><span></span>$<span class="w"> </span>chmod<span class="w"> </span>+x<span class="w"> </span>./scripts/migrate.sh
$<span class="w"> </span>./scripts/migrate.sh
Running<span class="w"> </span>migration:<span class="w"> </span>1_init.sql
CREATE<span class="w"> </span>TABLE
</pre></div>
<p>And let's add some data:</p>
<div class="highlight"><pre><span></span>$<span class="w"> </span>sudo<span class="w"> </span>su<span class="w"> </span>postgres
postgres<span class="w"> </span>$<span class="w"> </span>psql<span class="w"> </span>-U<span class="w"> </span>todo
<span class="nv">todo</span><span class="o">=</span><span class="c1"># INSERT INTO todo_item (item) VALUES (&#39;My note&#39;);</span>
</pre></div>
<p>Now we're ready to model the data in Java.</p>
<h3 id="models">Models</h3><p>While it's possible to have <a href="https://www.jooq.org/doc/3.12/manual/code-generation/">JOOQ generate Java data
classes</a> (or
POJOs) by reading the database schema, the generated class cannot be
directly serialized to a JSON string.</p>
<p>So for each table (there's only one) we'll write a class with fields
for each column. We'll use the <a href="https://javaee.github.io/tutorial/persistence-intro.html">Java Persistence
API</a> (JPA)
to annotate the class and fields so JOOQ will know how to deserialize
query results into an instance of the model.</p>
<p>We'll use <a href="https://projectlombok.org/">Lombok</a> to label the whole
object as <code>Data</code> so that getter and setter methods are
generated automatically for each private field. And we'll use a
<a href="https://github.com/FasterXML/jackson">Jackson</a> annotation to label
the JSON field name of each column.</p>
<p>This is the <code>TodoItem</code> class in
<code>src/main/java/api/model/TodoItem.java</code>:</p>
<div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">api.model</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.OffsetDateTime</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">javax.persistence.Column</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">javax.persistence.Id</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">javax.persistence.Table</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.annotation.JsonFormat</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.annotation.JsonProperty</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Data</span><span class="p">;</span>

<span class="nd">@Data</span>
<span class="nd">@Table</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;todo_item&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TodoItem</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;id&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="nd">@JsonProperty</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="nd">@Id</span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>

<span class="w">  </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;name&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="nd">@JsonProperty</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>

<span class="w">  </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;created_at&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="nd">@JsonProperty</span><span class="p">(</span><span class="s">&quot;createdAt&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="nd">@JsonFormat</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ssZ&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">OffsetDateTime</span><span class="w"> </span><span class="n">createdAt</span><span class="p">;</span>

<span class="w">  </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;completed_at&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="nd">@JsonProperty</span><span class="p">(</span><span class="s">&quot;completedAt&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="nd">@JsonFormat</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ssZ&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">OffsetDateTime</span><span class="w"> </span><span class="n">completedAt</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p class="note">
  The JSON format specifications for the timestamp fields aren't
  actually working. The formatted JSON returns a giant object and I
  haven't figured out how to get it to serialize to the RFC3339 string
  yet.
</p><p>We're set! The last step is a simple controller to return a list of
TODO items.</p>
<h3 id="the-/items-controller">The /items controller</h3><p>In the <code>ItemsController</code> class in
<code>src/main/java/api/model/ItemsController.java</code> we'll inject
the <code>Dao</code> object and use it to return a page of TODO items
as JSON.</p>
<div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">api.controller</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">javax.inject.Inject</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">javax.persistence.Table</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">javax.ws.rs.GET</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">javax.ws.rs.Path</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">javax.ws.rs.Produces</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">javax.ws.rs.core.MediaType</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.jooq.DSLContext</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">api.dao.Dao</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">api.model.TodoItem</span><span class="p">;</span>

<span class="nd">@Path</span><span class="p">(</span><span class="s">&quot;items&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ItemsController</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nd">@Inject</span>
<span class="w">  </span><span class="n">Dao</span><span class="w"> </span><span class="n">dao</span><span class="p">;</span>

<span class="w">  </span><span class="nd">@GET</span>
<span class="w">  </span><span class="nd">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">TodoItem</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getServers</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">DSLContext</span><span class="w"> </span><span class="n">dslCtx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">getDSLContext</span><span class="p">();</span>
<span class="w">    </span><span class="n">Table</span><span class="w"> </span><span class="n">table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TodoItem</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">getAnnotation</span><span class="p">(</span><span class="n">Table</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">dslCtx</span><span class="p">.</span><span class="na">select</span><span class="p">().</span><span class="na">from</span><span class="p">(</span><span class="n">table</span><span class="p">.</span><span class="na">name</span><span class="p">()).</span><span class="na">fetch</span><span class="p">().</span><span class="na">into</span><span class="p">(</span><span class="n">TodoItem</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p class="note">
  There's some more implicit magic here when we return a list of
  <code>TodoItem</code>s. Since we marked the endpoint as producing
  JSON, and since Jackson is in our class path, Jersey will
  automatically use Jackson to serialize the list to JSON.
  <br />
  <br />
  The API is quite nice but I could do without the automatic
  class-loading magic.
</p><p>Now we're ready to build, run and test.</p>
<h3 id="building-and-running">Building and running</h3><div class="highlight"><pre><span></span>$<span class="w"> </span>mvn<span class="w"> </span>clean<span class="w"> </span>compile
<span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>Scanning<span class="w"> </span><span class="k">for</span><span class="w"> </span>projects...
<span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>
<span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>------------------------------&lt;<span class="w"> </span>api:api<span class="w"> </span>&gt;-------------------------------
<span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>Building<span class="w"> </span>api<span class="w"> </span><span class="m">1</span>.0-SNAPSHOT
<span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>--------------------------------<span class="o">[</span><span class="w"> </span>jar<span class="w"> </span><span class="o">]</span>---------------------------------
<span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>
<span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>---<span class="w"> </span>maven-clean-plugin:2.5:clean<span class="w"> </span><span class="o">(</span>default-clean<span class="o">)</span><span class="w"> </span>@<span class="w"> </span>api<span class="w"> </span>---
<span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>Deleting<span class="w"> </span>/Users/philipeaton/tmp/test/target
<span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>
<span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>---<span class="w"> </span>maven-resources-plugin:2.6:resources<span class="w"> </span><span class="o">(</span>default-resources<span class="o">)</span><span class="w"> </span>@<span class="w"> </span>api<span class="w"> </span>---
<span class="o">[</span>WARNING<span class="o">]</span><span class="w"> </span>Using<span class="w"> </span>platform<span class="w"> </span>encoding<span class="w"> </span><span class="o">(</span>UTF-8<span class="w"> </span>actually<span class="o">)</span><span class="w"> </span>to<span class="w"> </span>copy<span class="w"> </span>filtered<span class="w"> </span>resources,<span class="w"> </span>i.e.<span class="w"> </span>build<span class="w"> </span>is<span class="w"> </span>platform<span class="w"> </span>dependent!
<span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>skip<span class="w"> </span>non<span class="w"> </span>existing<span class="w"> </span>resourceDirectory<span class="w"> </span>/Users/philipeaton/tmp/test/src/main/resources
<span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>
<span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>---<span class="w"> </span>maven-compiler-plugin:3.8.1:compile<span class="w"> </span><span class="o">(</span>default-compile<span class="o">)</span><span class="w"> </span>@<span class="w"> </span>api<span class="w"> </span>---
<span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>Changes<span class="w"> </span>detected<span class="w"> </span>-<span class="w"> </span>recompiling<span class="w"> </span>the<span class="w"> </span>module!
<span class="o">[</span>WARNING<span class="o">]</span><span class="w"> </span>File<span class="w"> </span>encoding<span class="w"> </span>has<span class="w"> </span>not<span class="w"> </span>been<span class="w"> </span>set,<span class="w"> </span>using<span class="w"> </span>platform<span class="w"> </span>encoding<span class="w"> </span>UTF-8,<span class="w"> </span>i.e.<span class="w"> </span>build<span class="w"> </span>is<span class="w"> </span>platform<span class="w"> </span>dependent!
<span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>Compiling<span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="nb">source</span><span class="w"> </span>files<span class="w"> </span>to<span class="w"> </span>/Users/philipeaton/tmp/test/target/classes
<span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>------------------------------------------------------------------------
<span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>BUILD<span class="w"> </span>SUCCESS
<span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>------------------------------------------------------------------------
<span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>Total<span class="w"> </span>time:<span class="w">  </span><span class="m">2</span>.198<span class="w"> </span>s
<span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>Finished<span class="w"> </span>at:<span class="w"> </span><span class="m">2020</span>-02-01T17:07:14-05:00
<span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>------------------------------------------------------------------------
$<span class="w"> </span>mvn<span class="w"> </span>exec:java
<span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>Scanning<span class="w"> </span><span class="k">for</span><span class="w"> </span>projects...
<span class="o">[</span>INFO<span class="o">]</span>
<span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>------------------------------&lt;<span class="w"> </span>api:api<span class="w"> </span>&gt;-------------------------------
<span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>Building<span class="w"> </span>api<span class="w"> </span><span class="m">1</span>.0-SNAPSHOT
<span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>--------------------------------<span class="o">[</span><span class="w"> </span>jar<span class="w"> </span><span class="o">]</span>---------------------------------
<span class="o">[</span>INFO<span class="o">]</span>
<span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>---<span class="w"> </span>exec-maven-plugin:1.6.0:java<span class="w"> </span><span class="o">(</span>default-cli<span class="o">)</span><span class="w"> </span>@<span class="w"> </span>api<span class="w"> </span>---
<span class="m">17</span>:06:53.793<span class="w"> </span><span class="o">[</span>api.Main.main<span class="o">()]</span><span class="w"> </span>INFO<span class="w"> </span>org.eclipse.jetty.util.log<span class="w"> </span>-<span class="w"> </span>Logging<span class="w"> </span>initialized<span class="w"> </span>@2017ms<span class="w"> </span>to<span class="w"> </span>org.eclipse.jetty.util.log.Slf4jLog
<span class="m">17</span>:06:54.378<span class="w"> </span><span class="o">[</span>api.Main.main<span class="o">()]</span><span class="w"> </span>INFO<span class="w"> </span>org.eclipse.jetty.server.Server<span class="w"> </span>-<span class="w"> </span>jetty-9.4.17.v20190418<span class="p">;</span><span class="w"> </span>built:<span class="w"> </span><span class="m">2019</span>-04-18T19:45:35.259Z<span class="p">;</span><span class="w"> </span>git:<span class="w"> </span>aa1c656c315c011c01e7b21aabb04066635b9f67<span class="p">;</span><span class="w"> </span>jvm<span class="w"> </span><span class="m">13</span>+33
<span class="m">17</span>:06:54.425<span class="w"> </span><span class="o">[</span>api.Main.main<span class="o">()]</span><span class="w"> </span>INFO<span class="w"> </span>org.eclipse.jetty.server.AbstractConnector<span class="w"> </span>-<span class="w"> </span>Started<span class="w"> </span>ServerConnector@3943a159<span class="o">{</span>HTTP/1.1,<span class="o">[</span>http/1.1<span class="o">]}{</span><span class="m">0</span>.0.0.0:7780<span class="o">}</span>
<span class="m">17</span>:06:54.425<span class="w"> </span><span class="o">[</span>api.Main.main<span class="o">()]</span><span class="w"> </span>INFO<span class="w"> </span>org.eclipse.jetty.server.Server<span class="w"> </span>-<span class="w"> </span>Started<span class="w"> </span>@2651ms
<span class="m">17</span>:06:54.425<span class="w"> </span><span class="o">[</span>api.Main.main<span class="o">()]</span><span class="w"> </span>INFO<span class="w"> </span>api.app.Application<span class="w"> </span>-<span class="w"> </span>Started<span class="w"> </span>listening<span class="w"> </span>on<span class="w"> </span>http://localhost:7780
</pre></div>
<p>In a new terminal curl the endpoint:</p>
<div class="highlight"><pre><span></span>$<span class="w"> </span>curl<span class="w"> </span>localhost:7780/items<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq
<span class="o">[</span>
<span class="w">  </span><span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;id&quot;</span>:<span class="w"> </span><span class="m">1</span>,
<span class="w">    </span><span class="s2">&quot;name&quot;</span>:<span class="w"> </span>null,
<span class="w">    </span><span class="s2">&quot;createdAt&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">      </span><span class="s2">&quot;offset&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="s2">&quot;totalSeconds&quot;</span>:<span class="w"> </span>-18000,
<span class="w">        </span><span class="s2">&quot;id&quot;</span>:<span class="w"> </span><span class="s2">&quot;-05:00&quot;</span>,
<span class="w">        </span><span class="s2">&quot;rules&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">          </span><span class="s2">&quot;transitions&quot;</span>:<span class="w"> </span><span class="o">[]</span>,
<span class="w">          </span><span class="s2">&quot;transitionRules&quot;</span>:<span class="w"> </span><span class="o">[]</span>,
<span class="w">          </span><span class="s2">&quot;fixedOffset&quot;</span>:<span class="w"> </span><span class="nb">true</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">      </span><span class="o">}</span>,
<span class="w">      </span><span class="s2">&quot;dayOfWeek&quot;</span>:<span class="w"> </span><span class="s2">&quot;SATURDAY&quot;</span>,
<span class="w">      </span><span class="s2">&quot;dayOfYear&quot;</span>:<span class="w"> </span><span class="m">32</span>,
<span class="w">      </span><span class="s2">&quot;nano&quot;</span>:<span class="w"> </span><span class="m">594440000</span>,
<span class="w">      </span><span class="s2">&quot;year&quot;</span>:<span class="w"> </span><span class="m">2020</span>,
<span class="w">      </span><span class="s2">&quot;monthValue&quot;</span>:<span class="w"> </span><span class="m">2</span>,
<span class="w">      </span><span class="s2">&quot;dayOfMonth&quot;</span>:<span class="w"> </span><span class="m">1</span>,
<span class="w">      </span><span class="s2">&quot;hour&quot;</span>:<span class="w"> </span><span class="m">17</span>,
<span class="w">      </span><span class="s2">&quot;minute&quot;</span>:<span class="w"> </span><span class="m">8</span>,
<span class="w">      </span><span class="s2">&quot;second&quot;</span>:<span class="w"> </span><span class="m">0</span>,
<span class="w">      </span><span class="s2">&quot;month&quot;</span>:<span class="w"> </span><span class="s2">&quot;FEBRUARY&quot;</span>
<span class="w">    </span><span class="o">}</span>,
<span class="w">    </span><span class="s2">&quot;completedAt&quot;</span>:<span class="w"> </span>null
<span class="w">  </span><span class="o">}</span>
<span class="o">]</span>
</pre></div>
<p>And we're done!</p>
<p><blockquote class="twitter-tweet"><p lang="en" dir="ltr">I really enjoy using Java for REST APIs, avoiding Spring and Play. Use simple but mature libraries that are no more difficult to cobble together than everything you must do in Go or Flask for a REST API. vs Go you get generics and vs python you get safety<a href="https://t.co/twmjZprow6">https://t.co/twmjZprow6</a></p>&mdash; Phil Eaton (@phil_eaton) <a href="https://twitter.com/phil_eaton/status/1223733417453465601?ref_src=twsrc%5Etfw">February 1, 2020</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></p>
<style>.feedback{display:initial;}</style>
	</div>
	<div class="feedback">
	  <h4>Feedback</h4>
	  <p>As always,
	      please <a href="mailto:phil@eatonphil.com">email</a>
	      or <a href="https://twitter.com/eatonphil">tweet me</a>
	      with questions, corrections, or ideas!</p>

	</div>
      </div>
    </div>
    <footer>
      <div class="container">
	<div>
	  <div id="subscribe">
	    <iframe frameBorder="0" src="https://cdn.forms-content-1.sg-form.com/e8ed4c3b-dd46-11f0-b6e6-ce075f2c5f80"/>

	  </div>
	</div>
      </div>
    </footer>
    <script async onload="loadGA()" src="https://www.googletagmanager.com/gtag/js?id=UA-58109156-2"></script>
    <script>
      function loadGA() {
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());
	  gtag('config', 'UA-58109156-2');
      }
    </script>
    <script defer src="https://cdn.usefathom.com/script.js" data-site="CEPUOLOQ"></script>
  </body>
</html>
